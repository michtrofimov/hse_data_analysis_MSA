## Лекция/Семинар 5. Обнаружение мотивов. Множественное выравнивание

**Референс:** весь репозиторий форкнут у Анны Рыбиной с ее разрешения. 

Анна Рыбина 12/11/2022

### Расположение файлов

Файлы для этого домашнего задания находятся в этом репозитории github: 

https://github.com/michtrofimov/hse_data_analysis_MSA

Если вам нужно просмотреть файл, ссылка будет: 

https://github.com/michtrofimov/hse_data_analysis_MSA/blob/master/data/upstreams.fasta

Чтобы скачать необработанный файл с github, есть 2 варианта:

a) щелкните правой кнопкой мыши по кнопке `Raw` в верхней части файла, выберите `Save Link As...` (или, в зависимости от версии вашего интернет-браузера, `Download Linked File As...`), выберите место на вашем компьютере, куда вы хотите сохранить файл, и выберите `Save`. 

б) нажмите `Raw` в окне GitHub с файлом, скопируйте ссылку из браузера и используйте `wget` для загрузки, как в примере ниже: 

```
wget https://github.com/michtrofimov/hse_data_analysis_MSA/blob/master/data/upstreams.fasta
```

### Задание 1. Множественное выравнивание

В этой части задания вы будете работать с выравниваниями с помощью трех популярных выравнивателей: MUSCLE, ClustalW и T-COFFEE. 

1.1. Скачайте файл с upstream регионами бактериальных ортологов (генов) (`upstreams.fasta`).

1.2. Выберите один из выравнивателей для работы с этими последовательностями. Ваша цель - найти небольшие (до 16 п.н.) регуляторные последовательности ДНК в 
upstream регионах бактериальных генов. Чтобы улучшить качество выравнивания, вы можете попробовать варьировать параметры. Пожалуйста, запишите эти параметры, вам нужно будет сообщить их в задании.

Полезные ссылки:

| Тул | Ссылка | CLI мануал | Оригинальная статья | Тип |
|----------|------------------------------------------|--------------------------------------------------------------------------|----------------|---|
| MUSCLE | https://www.ebi.ac.uk/Tools/msa/muscle | [`muscle` manual](https://www.drive5.com/muscle/manual/options.html) | [Edgar 2004](https://bmcbioinformatics.biomedcentral.com/articles/10.1186/1471-2105-5-113)           | Глобальное выравнивание |
| ClustalW | https://www.genome.jp/tools-bin/clustalw | [руководство `clustalw`](http://manpages.ubuntu.com/manpages/bionic/man1/clustalw.1.html) | [Thompson et al. 1994](https://academic.oup.com/nar/article-abstract/22/22/4673/2400290?redirectedFrom=fulltext)           | Глобальное выравнивание |
| T-COFFEE | http://tcoffee.crg.cat/ | [`t_coffee` manual](https://tcoffee.readthedocs.io/en/latest/tcoffee_main_documentation.html) | [Notredame et al. 2000](https://www.sciencedirect.com/science/article/abs/pii/S0022283600940427?via%3Dihub) | Глобальное и локальное выравнивание |

1.2.a. Если вы выбрали интерфейс веб-сервера, следуйте инструкциям на сайте, например: 

![Web Server Instructions 1](https://github.com/michtrofimov/hse_data_analysis_MSA/blob/master/images/Figure1.png)


![Инструкции веб-сервера 2](https://github.com/michtrofimov/hse_data_analysis_MSA/blob/master/images/Figure2.png)

Проверьте вывод этих команд. Каков формат выходного файла? 

> Подсказка: обычно выходные данные представлены в формате [FASTA](https://blast.ncbi.nlm.nih.gov/Blast.cgi?CMD=Web&PAGE_TYPE=BlastDocs&DOC_TYPE=BlastHelp) 
> или в формате [CLUSTAL](http://scikit-bio.org/docs/0.2.1/generated/skbio.io.clustal.html#:~:text=Format%20Specification,in%20the%20alignment%20%5BR152%5D.). 

1.3. Загрузите полученные файлы с выравниваниями или скопируйте сами полные выравнивания в буфер обмена. 

1.4. Визуализируйте **выравнивание** с помощью MView, предоставленного EMBL-EBI: [https://www.ebi.ac.uk/Tools/msa/mview/](https://www.ebi.ac.uk/Tools/msa/mview/).

Этот инструмент позволит вам вставить ваше выравнивание и выделить его на основе сохранения последовательности. 

**Уделите особое внимание**: 
- Тип последовательности, которую вы загружаете/вставляете (ДНК).
- Формат входных данных для выравнивания. Полный список форматов, принимаемых MView, можно найти [здесь] (https://www.ebi.ac.uk/seqdb/confluence/display/JDSAT/MView+Help+and+Documentation#MViewHelpandDocumentation-informat). 
Примеры различных форматов можно найти [здесь](https://www.hiv.lanl.gov/content/sequence/HelpDocs/SEQsamples.html)

> Не вставляйте исходный файл upstreams.fasta на этом шаге! Ваше выравнивание должно содержать пропуски (символы «-»). 

1.5. Предложите регион, который может быть консервативной регуляторной последовательностью ДНК в выравнивании генных восходящих потоков бактерий. 
Окончательно правильного ответа не существует, поэтому сосредоточьтесь на лучшем из наблюдаемых вами кандидатов и опишите свой вывод. 

Рассмотрите следующие критерии консервативной регуляторной последовательности: 
- Должна ли она присутствовать во всех последовательностях? (вероятно, да)
- Должна ли она содержать пропуски? (вероятно, нет)
- Должна ли она быть расположена близко к началу гена? (вероятно, да).

1.6. Попробуйте другой выравниватель. Изменился ли результат? 

Попробуйте все три выравнивателя, выберите тот, который дает наиболее полные и реалистичные регуляторные последовательности. 

Визуализируйте результат работы лучшего выравнивателя в месте наилучшего выравнивания кандидатной регуляторной последовательности. 
Вы можете выделить кандидатную регуляторную последовательность с помощью графического редактора.

Сохраните информацию о выравнивателе и изображение. **Это будет частью вашего домашнего задания (Задание 1)**.

1.7. Скопируйте выравнивание лучшего кандидата на мотив (регуляторную последовательнось) и вручную преобразуйте его в файл FASTA. 
Для выполнения этого задания используйте текстовый редактор, чтобы сохранить выделенный блок выравнивания в отдельный файл. 
Вы можете использовать Word, Notepad/TextEdit для создания только выравнивания. 

Полученный файл должен содержать что-то вроде:

```
>1
GGTCAATTCACTGCCTT
>2
GGCCAATTTACGGCCTT
>3
GGTCAGTTCACGGCATT
>4
TCCTAATTTACAGCAGC
>5
GGTCAGTTCACGGCATT
>6
GGCCAATTTACTGCGTT
>7
AACCAGCTTGAGACAGC
```

Сохраните этот файл и загрузите его на свой локальный компьютер. **Это будет вашим исходным материалом для построения PWM (задание 2)**.

### Задача 2. Построение матрицы позиционных весов (PWM)
 
Вы будете использовать результаты задачи 1 (1.7) для построения консенсусной последовательности и PWM. 

2.1. Выполните следующие действия:
- Зайдите в веб-инструмент RSAT: http://embnet.ccg.unam.mx/rsat/. 
- Нажмите -> ``Инструменты матрицы`` в левом меню 
-> ``конвертировать матрицу``.
- Выберите формат матрицы `«последовательности»`.
- Вставьте в поле выравнивание консервативных последовательностей в формате FASTA или загрузите файл
- Установите флажки «consensus», «counts», «frequencies», «weights», «profile» и «Compute reverse complement» (если они не выбраны). 
Установите все остальные параметры по умолчанию. Нажмите «GO». 

2.2. В выходных данных RSAT можно наблюдать переход от выравнивания к матрице количества нуклеотидов, 
матрице частот, затем к весам, профилю и логотипу. 

Сохраните логотип форварда на локальном компьютере. **Это будет частью вашего домашнего задания (Задание 2)**.

### Задача 3. Автоматизированный поиск мотивов в последовательностях с помощью MEME. 

3.1. Теперь перейдем к более автоматизированному инструменту - Multiple Expression motifs for Motif Elicitation (MEME, http://meme-suite.org/tools/meme). 

- Загрузите файл upstreams.fasta.
- Выберите ``One occurence per sequence`` для ``Select the site distribution``.
- Нажмите «Advanced options», установите значение «How wide can motifs be?» от 5 до 15. **Не забудьте про этот шаг, иначе вы будете ждать результатов довольно долго (почему?)**.
- Отправьте и ждите результатов
- Перейдите в раздел `«MEME HTML output»` и проверьте результат.

Первоначальная форма отправки должна выглядеть примерно так: 

![Инструкции MEME](https://github.com/michtrofimov/hse_data_analysis_MSA/blob/master/images/Figure3.png)

Есть ли среди найденных мотивов те, которые похожи на ваш результат, полученный вручную в задании 2? 
Попробуйте отправить наиболее значимый мотив в программу Tomtom для поиска похожих мотивов в публичных библиотеках (нажмите `Submit/Download`, выберите `Tomtom`, нажмите `Submit`, настройте параметры на поиск **prokaryotes**).
Сохраните полученный отчет на локальном компьютере. **Это будет частью вашего домашнего задания (задание 3)**.

### Задача 4. Поиск мотивов в данных ChIP-Seq

Теперь вы будете использовать MEME-ChIP для поиска мотивов в наборе данных ChIP-Seq. 
Ваши исходные данные - пики из эксперимента ChIP-Seq на _Gallus gallus_ (курица) для белка CTCF. 
Мы будем использовать эти данные для тестового запуска MEME-ChIP. 

- Загрузите пики ChIP-Seq ([peaks.fasta](https://github.com/michtrofimov/hse_data_analysis_MSA/blob/master/data/peaks.fasta)). 
- Перейдите в веб-интерфейс MEME-ChIP: http://meme-suite.org/ -> MEME-ChIP.
- Не меняя опций, отправьте файл `peaks.fasta`.

Результат будет выглядеть следующим образом: 

![MEME ChIP output](https://github.com/michtrofimov/hse_data_analysis_MSA/blob/master/images/Figure4.png)

Чтобы интерпретировать этот результат, посмотрите на:
- Количество найденных мотивов
- E-значения совпадений (Что вы считаете значимым?)
- Расхождение между E-значением лучшего попадания и E-значениями субоптимальных попаданий (Ожидаете ли вы большого расхождения для значимых попаданий?)
- Известные или схожие мотивы с хитом, полученным с помощью инструмента TOMTOM 
(Вы можете нажать на ссылки в этом поле, чтобы узнать больше. Являются ли совпадения, полученные с помощью TOMTOM, значимыми?)
- Сложность и длина логотипа. 
(Можно ли ожидать, что мотив окажется слишком коротким или будет содержать всего 2-4 информативные позиции?) 
- Распределение возможных сайтов связывания вокруг центров пиков. 

> Подсказка о том, как выбрать лучший мотив. 
> Вы работаете с пиками ChIP-Seq, которые представляют собой последовательности ДНК, связываемые белком CTCF.
> В ChIP-Seq белок связывается преимущественно в центре пиков. 
> Если в пиках с хорошим E-значением и центральным обогащением вы заметили какой-то мотив, 
> это признак истинного мотива связывания интересующего вас белка.
> Более того, если вы наблюдаете значительное сходство с CTCF других позвоночных, вы можете быть уверены, что нашли правильный мотив.

> Если вы заметили, что в ваших пиках значительно обогащены другие мотивы, это может быть совместное связывание факторов хроматина. 

Теперь, когда вы научились работать с MEME-ChIP, вы можете загрузить свой собственный файл с ChIP-Seq. У вас нет информации 
о факторе или виде. Вам необходимо получить эту информацию из результатов MEME-ChIP. 

4.1. Найдите свое имя и соответствующий файл в таблице, представленной в разделе «Файлы» для данного семинара в **Canvas**.

4.2. Загрузите ваш файл с пиками из папки «data/unknown_peaks» из этого репозитория: 

https://github.com/michtrofimov/hse_data_analysis_MSA/tree/master/data/unknown_peaks

4.3. Запустите MEME-ChIP и **ответьте на вопросы в Заданиях (Задание 4)**. Для этого вам может понадобиться скачать отчет MEME-ChIP (формат html). 

### Задание 5. Упражнение с командной строкой

Скачайте файл `S103_peaks.narrowPeak` с github. Этот файл является одним из выходных файлов, генерируемых программой `macs2` в результате вызова пиков, и содержит информацию о предсказанных регионах, связанных регулятором. Формат этого файла - .BED. Описание файла `NAME_peaks.narrowPeak` можно найти на официальном сайте программы `macs2`: https://github.com/macs3-project/MACS/blob/03e3492a4c1940544a6e63693fc23cba0f3c7f0f/docs/source/docs/callpeak.md#L4 

Нас интересует колонка, содержащая так называемые **fold-change** значения.  Метрика fold-change (=кратное изменение) показывает нам сигнал ChIP как кратное увеличение сигнала по отношению к фоновому сигналу. Чем выше fold-change, тем больше шансов, что ChIP-сигнал соответствует реальному событию связывания между изучаемым регулятором и участком ДНК, а не просто шуму (например, неспецифическому связыванию). 

Ваша задача - определить, какой пик имеет **самое высокое значение fold enrichment (=fold-change)**. Чтобы найти такой пик, воспользуйтесь командной строкой
> Подсказка: сортировка файла по определенному столбцу звучит подозрительно полезно...

В домашнем задании укажите 1) максимальное значение fold-change, 2) название пика с соответствующим fold enrichment и 3) команду `bash`, которую вы использовали для ответа на этот вопрос. 

### Домашнее задание

Задание проверит ваше понимание темы. Вы должны научиться использовать T-COFFEE, Muscle и ClustalW, строить мотивы из заданного выравнивания и выполнять _de novo_ поиск мотивов. Домашнее задание проверит правильность использования имеющихся в вашем распоряжении инструментов, умение наблюдать и интерпретировать результаты, а также выражать свое мнение по поводу полученных результатов. 

В домашнем задании используйте понятный научный язык и **не превышайте 200 слов на один ответ.**

Также обратите внимание, что ошибки в эссе (например, неправильные биологические факты) будут наказываться, даже если они не имеют отношения к заданному вопросу. 

### Благодарность

Особая благодарность Анне Рыбиной, Александре Галицыной за предоставленные материалы.
